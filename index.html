<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <script type='text/javascript' src='./renderer.js'></script>
  </head>
  <body>
    <div style="position: fixed; top:0px; padding-top: 10px; background-color: white;">
    [Top output]
    <input
      type="button"
      onclick="document.getElementById('result').innerHTML=''"
      value="clear"
    />
    <div
      id="result"
      style="width:700px; height:70px; border:1px solid black; overflow-y: scroll"
    ></div>
  </div>
  <h1 style="margin-top: 100px;">&lt;iframe&gt; security playground for Electron</h1>
    <p>
    Usage guide:<br>
    <ul>
      <li>This playground is only for Electron environment. Don't use it on Google Chrome.</li>
      <li>The top frame is local resource (file://).</li>
      <li>Push [button] => expected result (as of July.17, 2020) will be happen </li>
      <li>Passed result is shown on output area. </li>
      <li>Catchable error is shown on output area.</li>
      <li>Uncaught error is shown on console log of development tool.</li>
      <li>Verified on Electron 9.0.2 on Windows10</li>
      <li>Have fun!</li>
    </ul>
    </p>
    <h2>(A) Load file:// resource on iframe</h2>
    <p>
      No sandbox<br>
      &lt;iframe src='./frame01.html'&gt;
    </p>  
    <input
      type='button'
      onclick='postToChild("01", "Hello from parent via postMessage", "*")'
      value="Hello to child via postMessage, targetOrigin '*'"
    /> => Pass<br>
    <input
      type='button'
      onclick='sayToChildInGlobalScope("01", "Hello from parent via contentsWindow (Global Scope)")'
      value="Hello to child via contentsWindow (Global Scope)"
    /> => Pass<br>
    <input
      type='button'
      onclick='sayToChildInBlockScope("01", "Hello from parent via contentsWindow (Block Scope)")'
      value="Hello to child via contentsWindow (Block Scope)"
    /> => [Top output] "sayToChildInBlockScope() error: TypeError: document.getElementById(...).contentWindow.sayInBlockScope is not a function"

    <br><br>
    [childFrame]<br>
    <iframe id='childFrame01' src='./frame01.html' style='width:500px; height:200px; border: 1px solid black;'></iframe>
    <br/><br />


    <h2>(B) Load file:// resource on iframe with sandbox</h2>
    <p>
      Sandox with no allow-same-origin<br>
      &lt;iframe sandbox='allow-scripts' src='./frame02.html'&gt;
    </p>
    <p style="color: red">
      [Developer Tools console] "Not allowed to load local resource: file:///E:/src/electron-test/electron-test-security-sandbox/frame02.html"<br>
      [Developer Tools console] "Not allowed to load local resource: file:///E:/src/electron-test/electron-test-security-sandbox/frame02.js"
    </p>
    
    <input
      type='button'
      onclick='postToChild("02", "Hello from parent via postMessage", "*")'
      value="Hello to child via postMessage, targetOrigin '*'"
    /> => Nothing happens because frame02.js is not loaded.<br>
    <input
      type='button'
      onclick='sayToChildInGlobalScope("02", "Hello from parent via contentsWindow (Global Scope)")'
      value="Hello to child via contentsWindow (Global Scope)"
    /> => [Top output] "sayToChildInGlobalScope() error: TypeError: document.getElementById(...).contentWindow.sayInGlobalScope is not a function
    "<br>
    <br>
    [childFrame02]<br>
    <iframe id='childFrame02' src='./frame02.html' sandbox='allow-scripts' style='width:500px; height:150px; border: 1px solid black;'></iframe>
    <br/><br />


    <h2>(C) Load file:// resource on iframe with allow-same-origin</h2>    
    <p>
      Sandox with allow-same-origin<br>
      &lt;iframe sandbox='allow-same-origin allow-scripts' src='./frame03.html'&gt;
    </p>
    <input
      type='button'
      onclick='postToChild("03", "Hello from parent via postMessage", "file://")'
      value="Hello to child via postMessage, targetOrigin 'file://'"
    /> => Pass<br>
    <input
      type='button'
      onclick='sayToChildInGlobalScope("03", "Hello from parent via contentsWindow (Global Scope)")'
      value="Hello to child via contentsWindow (Global Scope)"
    /> => Pass<br>
    <input
      type='button'
      onclick='sayToChildInBlockScope("03", "Hello from parent via contentsWindow (Block Scope)")'
      value="Hello to child via contentsWindow (Block Scope)"
    /> => [Top output] "sayToChildInBlockScope() error: TypeError: document.getElementById(...).contentWindow.sayInBlockScope is not a function
"
    <br><br>
    [childFrame03]<br>
    <iframe id='childFrame03' src='./frame03.html' sandbox='allow-same-origin allow-scripts' style='width:500px; height:250px; border: 1px solid black;'></iframe>
    <br/><br />

    
    <h2>(D) Load https:// resource on iframe with allow-same-origin</h2>
    <p>
      Sandox with allow-same-origin<br>
      &lt;iframe sandbox='allow-same-origin allow-scripts' src='https://canal874-electron-test-security-sandbox.netlify.app/frame.html'&gt;
    </p>
    <input
      type='button'
      onclick='postToChild("04", "Hello from parent via postMessage", "file://")'
      value="Hello to child via postMessage, targetOrigin 'file://'"
    /> => Nothing happens because the targetOrigin file:// is different from https:// resource.<br>
    <input
      type='button'
      onclick='postToChild("04", "Hello from parent via postMessage", "*")'
      value="Hello to child via postMessage, targetOrigin '*'"
    /> => Pass<br>
    <input
      type='button'
      onclick='sayToChildInGlobalScope("04", "Hello from parent via contentsWindow (Global Scope)")'
      value="Hello to child via contentsWindow (Global Scope)"
    /> => [Top frame] "sayToChildInGlobalScope() error: SecurityError: Blocked a frame with origin "file://" from accessing a cross-origin frame."
    <br>
    <input
      type='button'
      onclick='sayToChildInBlockScope("04", "Hello from parent via contentsWindow (Block Scope)")'
      value="Hello to child via contentsWindow (Block Scope)"
    /> => [Top frame] "sayToChildInBlockScope() error: SecurityError: Blocked a frame with origin "file://" from accessing a cross-origin frame."
    <br>
    <br>
    [childFrame04]<br>    
    <iframe id='childFrame04' src='https://canal874-electron-test-security-sandbox.netlify.app/frame.html'' sandbox='allow-same-origin allow-scripts' style='width:500px; height:150px; border: 1px solid black;'></iframe>

    <!--    
    <br>
    <br>
    <h2>(D-1) Page navigation</h2>
    <p>
    The sandbox is set to 'allow-same-origin allow-scripts'.
    </p>
    [childFrame03-1]<br>
    <iframe id='childFrame03-1' src='./frame_navigation.html' sandbox='allow-same-origin allow-scripts' style='width:500px; height:150px; border: 1px solid black;'></iframe>
    <br/><br />   
    <h2>(D-2) Page navigation with allow-top-navigation</h2>
    <p>
    The sandbox is set to 'allow-same-origin allow-scripts allow-top-navigation'.
    </p>
    [childFrame03-2]<br>    
    <iframe id='childFrame03-2' src='./frame_navigation.html' sandbox='allow-same-origin allow-scripts allow-top-navigation' style='width:500px; height:150px; border: 1px solid black;'></iframe>
    <br/><br />   
    <h2>(E) Remove properties of window and window.document, try to change DOM</h2>
    <input type='button' onclick='changeDOM("Changed")' value='Change div01' /><br>    
    <input type='button' onclick='removeGlobalProperties()' value='Remove properties' /><br>
    <input type='button' onclick='changeDOM("Changed again")' value='Change div01 again' /><br>    
    <div id='div01' style='border:1px solid black'>&lt;div01&gt;</div>
    <br>
    <br>
    [childFrame04]<br>
    <iframe id='childFrame04' src='./frame.html' sandbox='allow-same-origin allow-scripts' style='width:500px; height:150px; border: 1px solid black;'></iframe>

    <h2>(F) Remove properties of window and window.document, try to navigate</h2>    
    <input type='button' onclick='removeGlobalProperties()' value='Remove properties' /><br>
    [childFrame05]<br>
    <iframe id='childFrame05' src='./frame_remove_attr.html' sandbox='allow-same-origin allow-scripts' style='width:500px; height:150px; border: 1px solid black;'></iframe>
    <br/><br />
-->
     </body>


</html>